</div>

<div class="current-players" id="current-players">
    <!DOCTYPE html>
    <html lang="ko">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÎòêÎ°±Ïì∞ ÏãúÏ∞∏ÏãúÍ∞Ñ Í¥ÄÎ¶¨ ÏÇ¨Ïù¥Ìä∏</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                color: #333;
                margin-bottom: 30px;
                font-size: 2.5em;
                background: linear-gradient(45deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            .timer-item {
                background: #f8f9fa;
                border: 2px solid #e9ecef;
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
                transition: all 0.3s ease;
            }

            .timer-item:hover {
                border-color: #667eea;
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
            }

            .timer-item.active {
                border-color: #28a745;
                background: #f8fff8;
            }

            .input-group {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .input-group label {
                font-size: 12px;
                color: #666;
                font-weight: bold;
            }

            input[type="text"],
            input[type="number"] {
                padding: 10px;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                font-size: 14px;
                transition: border-color 0.3s ease;
            }

            input[type="text"]:focus,
            input[type="number"]:focus {
                outline: none;
                border-color: #667eea;
            }

            .name-input {
                min-width: 140px;
            }

            .time-input {
                min-width: 60px;
                width: auto;
                padding: 8px;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                font-size: 14px;
                transition: border-color 0.3s ease;
                text-align: center;
            }

            .time-input:focus {
                outline: none;
                border-color: #667eea;
            }

            .time-inputs-group {
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .timer-display {
                font-size: 16px;
                font-weight: bold;
                color: #333;
                min-width: 200px;
                text-align: left;
                background: white;
                padding: 12px 15px;
                border-radius: 8px;
                border: 2px solid #e9ecef;
                display: flex;
                align-items: center;
                gap: 15px;
                white-space: nowrap;
            }

            .timer-display.running {
                color: #28a745;
                border-color: #28a745;
            }

            .control-btn {
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 14px;
            }

            .control-group {
                display: flex;
                gap: 10px;
                margin-left: auto;
            }

            .start-btn {
                background: #28a745;
                color: white;
            }

            .start-btn:hover {
                background: #218838;
            }

            .stop-btn {
                background: #dc3545;
                color: white;
            }

            .stop-btn:hover {
                background: #c82333;
            }

            .delete-btn {
                background: #6c757d;
                color: white;
                padding: 8px 12px;
                font-size: 12px;
            }

            .delete-btn:hover {
                background: #5a6268;
            }

            .usage-log {
                min-width: 200px;
                background: #f8f9fa;
                border: 2px solid #e9ecef;
                border-radius: 8px;
                padding: 12px;
                font-size: 12px;
                color: #666;
            }

            .usage-log-title {
                font-weight: bold;
                margin-bottom: 8px;
                color: #333;
            }

            .usage-log-content {
                max-height: 80px;
                overflow-y: auto;
                line-height: 1.4;
            }

            .usage-log-item {
                margin-bottom: 4px;
                padding: 2px 0;
                border-bottom: 1px solid #eee;
            }

            .usage-log-item:last-child {
                border-bottom: none;
                margin-bottom: 0;
            }

            .add-timer-btn {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 10px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                display: block;
                margin: 20px auto;
                transition: transform 0.3s ease;
            }

            .add-timer-btn:hover {
                transform: translateY(-2px);
            }

            .star-btn {
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-right: 10px;
                color: #ddd;
            }

            .star-btn.active {
                color: #ffd700;
                text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }

            .star-btn:hover {
                transform: scale(1.2);
            }

            .current-players {
                background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
                color: #333;
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 20px;
            }

            .current-players h3 {
                margin-bottom: 15px;
                text-align: center;
                color: #333;
            }

            .player-card {
                background: rgba(255, 255, 255, 0.8);
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border: 1px solid rgba(102, 126, 234, 0.2);
            }

            .player-info {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .player-time {
                font-family: 'Courier New', monospace;
                font-size: 18px;
                font-weight: bold;
                color: #333;
            }

            .no-players {
                text-align: center;
                color: #666;
                font-style: italic;
            }

            @media (max-width: 768px) {
                .timer-item {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 10px;
                }

                .input-group {
                    flex-direction: row;
                    align-items: center;
                    gap: 10px;
                }
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>‚è∞ ÎòêÎ°±Ïì∞ ÏãúÏ∞∏ÏãúÍ∞Ñ Í¥ÄÎ¶¨ ÏÇ¨Ïù¥Ìä∏</h1>
            <p style="text-align: center; color: #666; font-size: 14px; margin-top: -15px; margin-bottom: 20px;">Made
                by. ÍπÄÏ®îÏùë</p>

            <!-- Í∂åÌïú ÏÉÅÌÉú ÌëúÏãú -->
            <div id="auth-status"
                style="text-align: center; margin-bottom: 20px; padding: 10px; border-radius: 8px; background: #e3f2fd;">
                <span id="user-role">üëÄ ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Î™®Îìú (Ï°∞ÌöåÎßå Í∞ÄÎä•)</span>
                <button id="admin-login-btn" onclick="showAdminLogin()"
                    style="margin-left: 10px; padding: 5px 15px; border: none; background: #2196f3; color: white; border-radius: 5px; cursor: pointer;">Í¥ÄÎ¶¨Ïûê
                    Î°úÍ∑∏Ïù∏</button>
            </div>

            <!-- Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
            <div id="admin-modal"
                style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div
                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; text-align: center;">
                    <h3>üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</h3>
                    <input type="password" id="admin-password" placeholder="Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•"
                        style="padding: 10px; margin: 10px; border: 2px solid #ddd; border-radius: 8px; width: 200px;">
                    <div style="margin-top: 15px;">
                        <button onclick="adminLogin()"
                            style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 8px; margin-right: 10px; cursor: pointer;">Î°úÍ∑∏Ïù∏</button>
                        <button onclick="hideAdminLogin()"
                            style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer;">Ï∑®ÏÜå</button>
                    </div>
                </div>
            </div>

            <!-- Í≤ÄÏÉâ Î∞è Ï†ïÎ†¨ Í∏∞Îä• -->
            <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">üîç Ïù¥Î¶Ñ
                            Í≤ÄÏÉâ</label>
                        <input type="text" id="search-input" placeholder="ÏãúÏ≤≠Ïûê ÎãâÎÑ§ÏûÑÏúºÎ°ú Í≤ÄÏÉâ..."
                            style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;"
                            oninput="filterTimers()">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">üìä Ï†ïÎ†¨
                            Î∞©Ïãù</label>
                        <select id="sort-select" onchange="renderTimers()"
                            style="padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; background: white;">
                            <option value="recent">ÏµúÍ∑º ÏÇ¨Ïö© Ïàú</option>
                            <option value="name">Ïù¥Î¶Ñ Ïàú (Í∞ÄÎÇòÎã§)</option>
                            <option value="time">ÎÇ®ÏùÄ ÏãúÍ∞Ñ Ïàú</option>
                            <option value="active">ÌôúÏÑ± ÏÉÅÌÉú Ïàú</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">üìà ÌÜµÍ≥Ñ</label>
                        <div style="font-size: 14px; color: #666;">
                            Ï¥ù <span id="total-count">0</span>Î™Ö | ÌëúÏãú <span id="visible-count">0</span>Î™Ö
                        </div>
                    </div>
                </div>
            </div>
            <h3>üéÆ ÌòÑÏû¨ ÌîåÎ†àÏù¥ Ï§ëÏù∏ Ïù∏Ïõê</h3>
            <div id="active-players-list">
                <div class="no-players">ÌòÑÏû¨ ÌîåÎ†àÏù¥ Ï§ëÏù∏ Î©§Î≤ÑÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
            </div>
        </div>

        <div id="timers-container">
            <!-- ÌÉÄÏù¥Î®∏ Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>

        <button class="add-timer-btn" onclick="addTimer()" id="add-timer-btn">+ Ï§Ñ Ï∂îÍ∞Ä</button>
</div>

<script>
    let timers = [];
    let timerIdCounter = 0;
    let isAdmin = false; // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÏÉÅÌÉú
    let filteredTimers = []; // ÌïÑÌÑ∞ÎßÅÎêú ÌÉÄÏù¥Î®∏Îì§
    const adminPassword = "ddorong2025"; // Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏

    // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÌëúÏãú
    function showAdminLogin() {
        document.getElementById('admin-modal').style.display = 'block';
        document.getElementById('admin-password').focus();
    }

    // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î™®Îã¨ Ïà®Í∏∞Í∏∞
    function hideAdminLogin() {
        document.getElementById('admin-modal').style.display = 'none';
        document.getElementById('admin-password').value = '';
    }

    // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
    function adminLogin() {
        const password = document.getElementById('admin-password').value;
        if (password === adminPassword) {
            isAdmin = true;
            updateAuthStatus();
            hideAdminLogin();
            renderTimers();
            alert('‚úÖ Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! Î™®Îì† Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
        } else {
            alert('‚ùå ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§.');
            document.getElementById('admin-password').value = '';
        }
    }

    // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏ÏïÑÏõÉ
    function adminLogout() {
        isAdmin = false;
        updateAuthStatus();
        renderTimers();
        alert('üëã Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.');
    }

    // Í∂åÌïú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    function updateAuthStatus() {
        const userRole = document.getElementById('user-role');
        const loginBtn = document.getElementById('admin-login-btn');

        if (isAdmin) {
            userRole.innerHTML = 'üîß Í¥ÄÎ¶¨Ïûê Î™®Îìú (ÏàòÏ†ï Í∞ÄÎä•)';
            loginBtn.innerHTML = 'Î°úÍ∑∏ÏïÑÏõÉ';
            loginBtn.onclick = adminLogout;
            document.getElementById('auth-status').style.background = '#e8f5e8';
        } else {
            userRole.innerHTML = 'üëÄ ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê Î™®Îìú (Ï°∞ÌöåÎßå Í∞ÄÎä•)';
            loginBtn.innerHTML = 'Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏';
            loginBtn.onclick = showAdminLogin;
            document.getElementById('auth-status').style.background = '#e3f2fd';
        }
    }

    // Enter ÌÇ§Î°ú Î°úÍ∑∏Ïù∏
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Enter' && document.getElementById('admin-modal').style.display === 'block') {
            adminLogin();
        }
    });

    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    function loadData() {
        const savedTimers = localStorage.getItem('timeManagerTimers');
        if (savedTimers) {
            timers = JSON.parse(savedTimers);
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê ÌïÑÎìúÍ∞Ä ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä
            timers.forEach(timer => {
                if (timer.totalSeconds === undefined) {
                    timer.totalSeconds = 0;
                }
                if (timer.totalHours === undefined) {
                    timer.totalHours = 0;
                }
                if (timer.isActive === undefined) {
                    timer.isActive = false;
                }
                if (timer.lastUsed === undefined) {
                    timer.lastUsed = Date.now(); // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê ÌòÑÏû¨ ÏãúÍ∞ÑÏúºÎ°ú ÏÑ§Ï†ï
                }
            });
            timerIdCounter = Math.max(...timers.map(t => t.id), 0) + 1;
            renderTimers();
        } else {
            // Ï¥àÍ∏∞ ÌÉÄÏù¥Î®∏ ÌïòÎÇò Ï∂îÍ∞Ä
            addTimer();
        }
    }

    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
    function saveData() {
        localStorage.setItem('timeManagerTimers', JSON.stringify(timers));
    }

    // ÏÉà ÌÉÄÏù¥Î®∏ Ï∂îÍ∞Ä
    function addTimer() {
        if (!isAdmin) {
            alert('‚ùå Í¥ÄÎ¶¨ÏûêÎßå ÌÉÄÏù¥Î®∏Î•º Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.');
            return;
        }

        const newTimer = {
            id: timerIdCounter++,
            name: '',
            totalHours: 0,
            totalMinutes: 0,
            totalSeconds: 0,
            currentTime: 0,
            isRunning: false,
            isActive: false, // ÌòÑÏû¨ ÌîåÎ†àÏù¥ Ï§ëÏù∏ÏßÄ Ïó¨Î∂Ä
            startTime: null,
            lastUsed: Date.now(), // ÎßàÏßÄÎßâ ÏÇ¨Ïö© ÏãúÍ∞Ñ Ï∂îÍ∞Ä
            usageLog: []
        };

        timers.push(newTimer);
        renderTimers();
        renderActivePlayers();
        saveData();
    }

    // ÌÉÄÏù¥Î®∏ ÏÇ≠Ï†ú
    function deleteTimer(id) {
        if (!isAdmin) {
            alert('‚ùå Í¥ÄÎ¶¨ÏûêÎßå ÌÉÄÏù¥Î®∏Î•º ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.');
            return;
        }

        if (confirm('Ï†ïÎßêÎ°ú Ïù¥ ÌÉÄÏù¥Î®∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
            timers = timers.filter(timer => timer.id !== id);
            renderTimers();
            renderActivePlayers();
            saveData();
        }
    }

    // ÌîåÎ†àÏù¥Ïñ¥ ÌôúÏÑ± ÏÉÅÌÉú ÌÜ†Í∏Ä
    function togglePlayerActive(id) {
        if (!isAdmin) {
            alert('‚ùå Í¥ÄÎ¶¨ÏûêÎßå ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.');
            return;
        }

        const timer = timers.find(t => t.id === id);
        if (!timer) return;

        const activePlayers = timers.filter(t => t.isActive).length;

        if (!timer.isActive && activePlayers >= 3) {
            alert('ÏµúÎåÄ 3Î™ÖÍπåÏßÄÎßå ÎèôÏãúÏóê ÌîåÎ†àÏù¥Ìï† Ïàò ÏûàÏäµÎãàÎã§!');
            return;
        }

        timer.isActive = !timer.isActive;
        timer.lastUsed = Date.now(); // ÏÉÅÌÉú Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ ÏµúÍ∑º ÏÇ¨Ïö©ÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏

        // ÎπÑÌôúÏÑ±ÌôîÎêòÎ©¥ ÌÉÄÏù¥Î®∏ÎèÑ Ï†ïÏßÄ
        if (!timer.isActive && timer.isRunning) {
            toggleTimer(id);
        }

        renderTimers();
        renderActivePlayers();
        saveData();
    }

    // ÌÉÄÏù¥Î®∏ ÏãúÏûë/Ï†ïÏßÄ
    function toggleTimer(id) {
        if (!isAdmin) {
            alert('‚ùå Í¥ÄÎ¶¨ÏûêÎßå ÌÉÄÏù¥Î®∏Î•º Ï†úÏñ¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
            return;
        }

        const timer = timers.find(t => t.id === id);
        if (!timer) return;

        // ÌÉÄÏù¥Î®∏ ÏÇ¨Ïö© Ïãú lastUsed ÏóÖÎç∞Ïù¥Ìä∏
        timer.lastUsed = Date.now();

        if (timer.isRunning) {
            // Ï†ïÏßÄ
            timer.isRunning = false;
            const endTime = Date.now();
            const usedTime = Math.floor((endTime - timer.startTime) / 1000);
            const usedHours = Math.floor(usedTime / 3600);
            const usedMinutes = Math.floor((usedTime % 3600) / 60);

            // ÏÇ¨Ïö© Î°úÍ∑∏ Ï∂îÍ∞Ä
            const now = new Date();
            const logEntry = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}: ${usedHours}ÏãúÍ∞Ñ ${usedMinutes}Î∂Ñ ÏÇ¨Ïö©`;
            timer.usageLog.unshift(logEntry);

            // Î°úÍ∑∏Îäî ÏµúÎåÄ 10Í∞úÍπåÏßÄÎßå Î≥¥Í¥Ä
            if (timer.usageLog.length > 10) {
                timer.usageLog = timer.usageLog.slice(0, 10);
            }

            timer.startTime = null;
        } else {
            // ÏãúÏûë - Î≥¥Ïú† ÏãúÍ∞ÑÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            const totalSeconds = (timer.totalHours * 3600) + (timer.totalMinutes * 60) + timer.totalSeconds;
            if (totalSeconds <= timer.currentTime) {
                alert('Î≥¥Ïú† ÏãúÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!');
                return;
            }

            timer.isRunning = true;
            timer.startTime = Date.now();
        }

        renderTimers();
        saveData();
    }

    // ÏãúÍ∞Ñ ÌòïÏãù Î≥ÄÌôò (Ï¥à -> Ïãú:Î∂Ñ:Ï¥à)
    function formatTime(seconds) {
        // NaN Ï≤¥ÌÅ¨
        if (isNaN(seconds) || seconds < 0) {
            seconds = 0;
        }

        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // ÌÉÄÏù¥Î®∏ ÏóÖÎç∞Ïù¥Ìä∏ (Îß§Ï¥àÎßàÎã§ Ïã§Ìñâ)
    function updateTimers() {
        let updated = false;
        const now = Date.now();

        timers.forEach(timer => {
            if (timer.isRunning && timer.startTime) {
                const elapsed = Math.floor((now - timer.startTime) / 1000);
                timer.currentTime = Math.min(
                    timer.currentTime + 1,
                    (timer.totalHours * 3600) + (timer.totalMinutes * 60) + timer.totalSeconds
                );

                // ÏãúÍ∞ÑÏù¥ Îã§ ÏÜåÎ™®ÎêòÎ©¥ ÏûêÎèô Ï†ïÏßÄ
                if (timer.currentTime >= (timer.totalHours * 3600) + (timer.totalMinutes * 60) + timer.totalSeconds) {
                    timer.isRunning = false;
                    timer.startTime = null;
                    alert(`${timer.name || 'ÌÉÄÏù¥Î®∏'}Ïùò ÏãúÍ∞ÑÏù¥ Î™®Îëê ÏÜåÎ™®ÎêòÏóàÏäµÎãàÎã§!`);
                }

                updated = true;
            }
        });

        if (updated) {
            renderTimers();
            saveData();
        }
    }

    // ÌÉÄÏù¥Î®∏ ÌïÑÌÑ∞ÎßÅ Î∞è Ï†ïÎ†¨
    function getFilteredAndSortedTimers() {
        const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || '';
        const sortBy = document.getElementById('sort-select')?.value || 'recent';

        // Í≤ÄÏÉâ ÌïÑÌÑ∞ÎßÅ
        let filtered = timers.filter(timer =>
            timer.name.toLowerCase().includes(searchTerm)
        );

        // Ï†ïÎ†¨
        switch (sortBy) {
            case 'recent':
                filtered.sort((a, b) => (b.lastUsed || 0) - (a.lastUsed || 0));
                break;
            case 'name':
                filtered.sort((a, b) => a.name.localeCompare(b.name));
                break;
            case 'time':
                filtered.sort((a, b) => {
                    const aTotal = (a.totalHours * 3600) + (a.totalMinutes * 60) + a.totalSeconds - a.currentTime;
                    const bTotal = (b.totalHours * 3600) + (b.totalMinutes * 60) + b.totalSeconds - b.currentTime;
                    return bTotal - aTotal;
                });
                break;
            case 'active':
                filtered.sort((a, b) => {
                    if (a.isActive && !b.isActive) return -1;
                    if (!a.isActive && b.isActive) return 1;
                    if (a.isRunning && !b.isRunning) return -1;
                    if (!a.isRunning && b.isRunning) return 1;
                    return (b.lastUsed || 0) - (a.lastUsed || 0);
                });
                break;
        }

        return filtered;
    }

    // ÌÉÄÏù¥Î®∏ ÌïÑÌÑ∞ÎßÅ (Í≤ÄÏÉâ)
    function filterTimers() {
        renderTimers();
    }
    // ÌÉÄÏù¥Î®∏ Î†åÎçîÎßÅ
    function renderTimers() {
        const container = document.getElementById('timers-container');
        container.innerHTML = '';

        // ÌïÑÌÑ∞ÎßÅ Î∞è Ï†ïÎ†¨Îêú ÌÉÄÏù¥Î®∏ Í∞ÄÏ†∏Ïò§Í∏∞
        filteredTimers = getFilteredAndSortedTimers();

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('total-count').textContent = timers.length;
        document.getElementById('visible-count').textContent = filteredTimers.length;

        filteredTimers.forEach(timer => {
            const timerElement = document.createElement('div');
            timerElement.className = `timer-item ${timer.isRunning ? 'active' : ''}`;

            const totalSeconds = (timer.totalHours * 3600) + (timer.totalMinutes * 60) + timer.totalSeconds;
            const remainingSeconds = Math.max(0, totalSeconds - timer.currentTime);

            timerElement.innerHTML = `
                    <button class="star-btn ${timer.isActive ? 'active' : ''}" 
                            onclick="togglePlayerActive(${timer.id})" ${!isAdmin ? 'disabled' : ''}>
                        ${timer.isActive ? '‚≠ê' : '‚òÜ'}
                    </button>
                            
                    <div class="input-group">
                        <label>ÎãâÎÑ§ÏûÑ(ÏãúÏ≤≠Ïûê ÎãâÎÑ§ÏûÑ)</label>
                        <input type="text" class="name-input" value="${timer.name}" 
                               onchange="updateTimerName(${timer.id}, this.value)" 
                               placeholder="ÏãúÏ≤≠Ïûê ÎãâÎÑ§ÏûÑ" ${!isAdmin ? 'readonly' : ''}>
                    </div>
                    
                    <div class="input-group">
                        <label>Î≥¥Ïú† ÏãúÍ∞Ñ</label>
                        <div class="time-inputs-group">
                            <input type="number" class="time-input" value="${timer.totalHours}" min="0" max="23"
                                   onchange="updateTimerHours(${timer.id}, this.value)" 
                                   placeholder="0" ${!isAdmin ? 'readonly' : ''}>
                            <span>:</span>
                            <input type="number" class="time-input" value="${timer.totalMinutes}" min="0" max="59"
                                   onchange="updateTimerMinutes(${timer.id}, this.value)" 
                                   placeholder="0" ${!isAdmin ? 'readonly' : ''}>
                            <span>:</span>
                            <input type="number" class="time-input" value="${timer.totalSeconds}" min="0" max="59"
                                   onchange="updateTimerSeconds(${timer.id}, this.value)" 
                                   placeholder="0" ${!isAdmin ? 'readonly' : ''}>
                        </div>
                    </div>
                    
                    <div class="timer-display ${timer.isRunning ? 'running' : ''}">
                        <span>ÎÇ®ÏùÄ ÏãúÍ∞Ñ</span>
                        <span style="font-family: 'Courier New', monospace; font-size: 18px;">${formatTime(remainingSeconds)}</span>
                    </div>
                    
                    <div class="control-group" ${!isAdmin ? 'style="display: none;"' : ''}>
                        <button class="control-btn ${timer.isRunning ? 'stop-btn' : 'start-btn'}" 
                                onclick="toggleTimer(${timer.id})">
                            ${timer.isRunning ? 'STOP' : 'START'}
                        </button>
                        
                        <button class="control-btn delete-btn" onclick="deleteTimer(${timer.id})">ÏÇ≠Ï†ú</button>
                    </div>
                    
                    <div class="usage-log">
                        <div class="usage-log-title">üìù ÏÇ¨Ïö© Í∏∞Î°ù</div>
                        <div class="usage-log-content">
                            ${timer.usageLog.length > 0 ?
                    timer.usageLog.slice(0, 4).map(log =>
                        `<div class="usage-log-item">${log}</div>`
                    ).join('')
                    : '<div class="usage-log-item" style="color: #999; font-style: italic;">Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>'
                }
                        </div>
                    </div>
                `;

            container.appendChild(timerElement);
        });

        renderActivePlayers();

        // Ï§Ñ Ï∂îÍ∞Ä Î≤ÑÌäº ÌëúÏãú/Ïà®Í∏∞Í∏∞
        const addTimerBtn = document.getElementById('add-timer-btn');
        if (addTimerBtn) {
            addTimerBtn.style.display = isAdmin ? 'block' : 'none';
        }
    }

    // ÌòÑÏû¨ ÌîåÎ†àÏù¥ Ï§ëÏù∏ Î©§Î≤ÑÎì§ Î†åÎçîÎßÅ
    function renderActivePlayers() {
        const activePlayersList = document.getElementById('active-players-list');
        const activePlayers = timers.filter(timer => timer.isActive);

        if (activePlayers.length === 0) {
            activePlayersList.innerHTML = '<div class="no-players">ÌòÑÏû¨ ÌîåÎ†àÏù¥ Ï§ëÏù∏ Î©§Î≤ÑÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
            return;
        }

        activePlayersList.innerHTML = activePlayers.map(timer => {
            const totalSeconds = (timer.totalHours * 3600) + (timer.totalMinutes * 60) + timer.totalSeconds;
            const remainingSeconds = Math.max(0, totalSeconds - timer.currentTime);

            return `
                    <div class="player-card">
                        <div class="player-info">
                            <span>‚≠ê</span>
                            <span><strong>${timer.name || 'ÏùµÎ™Ö ÌîåÎ†àÏù¥Ïñ¥'}</strong></span>
                            <span class="${timer.isRunning ? '' : 'no-running'}">${timer.isRunning ? 'üéÆ ÌîåÎ†àÏù¥ Ï§ë' : '‚è∏Ô∏è ÎåÄÍ∏∞ Ï§ë'}</span>
                        </div>
                        <div class="player-time">${formatTime(remainingSeconds)}</div>
                    </div>
                `;
        }).join('');
    }

    // ÌÉÄÏù¥Î®∏ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏
    function updateTimerName(id, name) {
        if (!isAdmin) return;

        const timer = timers.find(t => t.id === id);
        if (timer) {
            timer.name = name;
            timer.lastUsed = Date.now(); // Ïù¥Î¶Ñ Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ ÏµúÍ∑º ÏÇ¨Ïö©ÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            saveData();
            renderTimers(); // Ï†ïÎ†¨ ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ Îã§Ïãú Î†åÎçîÎßÅ
        }
    }

    // ÌÉÄÏù¥Î®∏ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
    function updateTimerHours(id, hours) {
        if (!isAdmin) return;

        const timer = timers.find(t => t.id === id);
        if (timer) {
            timer.totalHours = parseInt(hours) || 0;
            timer.lastUsed = Date.now(); // ÏãúÍ∞Ñ Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ ÏµúÍ∑º ÏÇ¨Ïö©ÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            saveData();
            renderTimers();
        }
    }

    function updateTimerMinutes(id, minutes) {
        if (!isAdmin) return;

        const timer = timers.find(t => t.id === id);
        if (timer) {
            timer.totalMinutes = parseInt(minutes) || 0;
            timer.lastUsed = Date.now();
            saveData();
            renderTimers();
        }
    }

    function updateTimerSeconds(id, seconds) {
        if (!isAdmin) return;

        const timer = timers.find(t => t.id === id);
        if (timer) {
            timer.totalSeconds = parseInt(seconds) || 0;
            timer.lastUsed = Date.now();
            saveData();
            renderTimers();
        }
    }

    // Ï¥àÍ∏∞Ìôî Î∞è Ï£ºÍ∏∞Ï†Å ÏóÖÎç∞Ïù¥Ìä∏
    window.onload = function () {
        updateAuthStatus(); // Í∂åÌïú ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
        loadData();
        setInterval(updateTimers, 1000); // Îß§Ï¥àÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏
    };
</script>
</body>

</html>